# 安全加固与生产级部署方案进展文档

> 更新时间: 2026-02-25 01:10

## 本阶段目标
为系统添加安全防护层，防止接口裸奔，并符合毕业设计的工程化要求。

---

## 改造清单与完成状态

### ✅ 1. API 安全加锁 (Backend)

**问题**: 后端接口 `/api/dashboard` 处于公开状态，任何客户端均可直接访问数据。

**方案**:
- 在 `main.py` 中引入 `verify_api_key` 中间件。
- **校验逻辑**: 拦截所有进入的 HTTP 请求，检查 Header 中是否存在 `X-API-KEY` 且值是否匹配。
- **白名单**: 排除 `/docs`, `/redoc`, `/openapi.json` 等路径，确保 API 文档可正常预览。
- **配置化**: `API_KEY_SECRET` 优先从环境变量读取，提升安全性。

**状态**: ✅ 已完成并验证 (返回 403 Forbidden 当 Key 错误时)。

---

### ✅ 2. 前端 Header 同步 (Frontend)

**问题**: 后端加锁后，前端请求将因缺少 Key 被拦截。

**方案**:
- 修改 `App.vue` 中的 `fetchData` 函数。
- 在 `axios.get` 请求中增加 `headers` 配置。
- 注入 `{'X-API-KEY': 'graduation_project_2026'}`。

**状态**: ✅ 已完成并验证 (页面数据渲染正常)。

---

### ✅ 3. 生产级部署方案建议 (工程化文档补全)

作为毕业设计，除了代码实现，还需补充以下部署建议：

1. **环境变量管理**: 建议在生产环境使用 `.env` 文件或容器编排工具（如 K8s Secret）管理 `API_KEY_SECRET`、`CH_PASSWORD`、`CORS_ORIGINS` 等敏感信息。
2. **反向代理**: 使用 Nginx 作为反向代理，处理 SSL/TLS 加密，并将 `/api` 转发至 FastAPI，将静态资源转发至前端构建目录。
3. **日志审计**: 在中间件中增加日志记录（如请求来源 IP、请求耗时、访问结果），以便后续审计。
4. **限流策略**: 建议引入 `slowapi` 等库，防止针对 API 的暴力破解或恶意刷票。

---

## 验证结论

- **后端校验**: 使用 `curl` 验证，不带 Key 返回 `403`，带正确 Key 返回数据。
- **前端集成**: 浏览器访问 `http://localhost:5173/`，所有图表正常加载，控制台无权限错误。
- **代码规范**: 符合 FastAPI 中间件最佳实践。

## 文件变更

| 文件 | 操作 | 说明 |
|------|------|------|
| `main.py` | 修改 | 添加 API Key 校验中间件 |
| `frontend/src/App.vue` | 修改 | 在 Axios 请求头中注入 API Key |
| `doc/security_hardening_progress.md` | 新建 | 本文档 |
